<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark">
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-EV8RVEFX82"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-EV8RVEFX82');
            
        </script>
    <link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <link rel="shortcut icon" href="https://raw.githubusercontent.com/cleanlab/assets/a4483476d449f2f05a4c7cde329e72358099cc07/cleanlab/cleanlab_favicon.svg"/><!-- Generated with Sphinx 7.1.2 and Furo 2023.09.10 -->
        <title>cleanlab.object_detection.summary - cleanlab</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=96bccb3e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">cleanlab</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a style="padding-bottom: 0px;" class="sidebar-brand" href="../../../index.html">
    
    <div class="sidebar-logo-container">
        <img class="sidebar-logo" src="https://raw.githubusercontent.com/cleanlab/assets/master/cleanlab/cleanlab_logo_only.png" alt="Logo" />
    </div>
    
    <span style="margin-bottom:0px" class="sidebar-brand-text">
        cleanlab
    </span>
    
</a>

<div style="margin-left: 12px; margin-top: 4px;">
    <a style="margin-top: 6px;" class="github-button" href="https://github.com/cleanlab/cleanlab" data-size="large" data-show-count="true"
    aria-label="Star cleanlab/cleanlab on GitHub">Star</a>
</div>
<form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorials/datalab/index.html">Datalab Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Datalab Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/datalab/datalab_quickstart.html">Detecting Common Data Issues with Datalab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/datalab/datalab_advanced.html">Advanced Data Auditing with Datalab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/datalab/text.html">Text Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/datalab/tabular.html">Tabular Data (Numeric/Categorical)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/datalab/image.html">Image Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/datalab/audio.html">Audio Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/datalab/guide/issue_type_description.html">Guide to Datalab Issue Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/datalab/workflows.html">Miscellaneous workflows with Datalab</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/improving_ml_performance.html">Improving ML Performance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorials/clean_learning/index.html">CleanLearning Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of CleanLearning Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/clean_learning/text.html">Text Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/clean_learning/tabular.html">Tabular Classification (Numeric/Categorical)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/indepth_overview.html">Workflows of Data-Centric AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dataset_health.html">Analyze Dataset-level Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/outliers.html">Outlier Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/multiannotator.html">Improving Consensus Labels for Multiannotator Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/multilabel_classification.html">Multi-Label Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/regression.html">Noisy Labels in Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/token_classification.html">Token Classification (text)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/segmentation.html">Image Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/object_detection.html">Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/pred_probs_cross_val.html">Predicted Probabilities via Cross Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/datalab/index.html">datalab</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of datalab</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../cleanlab/datalab/guide/index.html">Datalab guides</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Datalab guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/guide/issue_type_description.html">Datalab Issue Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/guide/custom_issue_manager.html">Creating Your Own Issues Manager</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/datalab/datalab.html">datalab</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../cleanlab/datalab/internal/index.html">internal</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of internal</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../cleanlab/datalab/internal/adapter/index.html">adapter</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of adapter</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/adapter/imagelab.html">imagelab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/internal/data.html">data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/internal/data_issues.html">data_issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_finder.html">issue_finder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/internal/factory.html">factory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/internal/model_outputs.html">model_outputs</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/index.html">issue_manager</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of issue_manager</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/issue_manager.html">Base issue_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/label.html">label</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/outlier.html">outlier</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/duplicate.html">duplicate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/noniid.html">noniid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/imbalance.html">imbalance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/underperforming_group.html">underperforming_group</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/null.html">null</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/data_valuation.html">data_valuation</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/regression/index.html">regression</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of regression</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/regression/label.html">label</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/multilabel/index.html">multilabel</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of multilabel</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../cleanlab/datalab/internal/issue_manager/multilabel/label.html">label</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/internal/report.html">report</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/datalab/internal/task.html">task</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cleanlab/classification.html">classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cleanlab/filter.html">filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cleanlab/rank.html">rank</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cleanlab/count.html">count</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cleanlab/dataset.html">dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cleanlab/outlier.html">outlier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cleanlab/multiannotator.html">multiannotator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cleanlab/data_valuation.html">data_valuation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/multilabel_classification/index.html">multilabel_classification</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of multilabel_classification</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/multilabel_classification/filter.html">filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/multilabel_classification/rank.html">rank</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/multilabel_classification/dataset.html">dataset</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/regression/index.html">regression</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of regression</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/regression/rank.html">regression.rank</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/regression/learn.html">regression.learn</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/token_classification/index.html">token_classification</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of token_classification</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/token_classification/filter.html">filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/token_classification/rank.html">rank</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/token_classification/summary.html">summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/segmentation/index.html">segmentation</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of segmentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/segmentation/rank.html">rank</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/segmentation/filter.html">filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/segmentation/summary.html">summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/object_detection/index.html">object_detection</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of object_detection</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/object_detection/rank.html">rank</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/object_detection/filter.html">filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/object_detection/summary.html">summary</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/benchmarking/index.html">benchmarking</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of benchmarking</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/benchmarking/noise_generation.html">noise_generation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/models/index.html">models</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/models/keras.html">keras</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/experimental/index.html">experimental</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of experimental</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/experimental/label_issues_batched.html">label_issues_batched</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/experimental/span_classification.html">span_classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/experimental/mnist_pytorch.html">mnist_pytorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/experimental/coteaching.html">coteaching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/experimental/cifar_cnn.html">cifar_cnn</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/internal/index.html">internal</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of internal</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/internal/util.html">util</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/internal/latent_algebra.html">latent_algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/internal/label_quality_utils.html">label_quality_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/internal/multilabel_utils.html">multilabel_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/internal/multilabel_scorer.html">multilabel_scorer</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../cleanlab/internal/neighbor/index.html">neighbor</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of neighbor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/internal/neighbor/knn_graph.html">knn_graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/internal/neighbor/metric.html">metric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cleanlab/internal/neighbor/search.html">search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/internal/outlier.html">outlier</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/internal/token_classification_utils.html">token_classification_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/internal/validation.html">validation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cleanlab/datalab/guide/index.html">Datalab issue types</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of Datalab issue types</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/datalab/guide/issue_type_description.html">Datalab Issue Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cleanlab/datalab/guide/custom_issue_manager.html">Creating Your Own Issues Manager</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/cleanlab/cleanlab/blob/master/CONTRIBUTING.md">How to contribute</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://cleanlab.ai">Website</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/cleanlab/cleanlab">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/cleanlab/">PyPI</a></li>
<li class="toctree-l1"><a class="reference external" href="https://anaconda.org/conda-forge/cleanlab">Conda</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cleanlab.ai/slack">Community Discussions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cleanlab.ai/blog/">Blog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.youtube.com/@CleanlabAI/playlists">Videos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cleanlab.ai/blog/data-centric-ai/">Cleanlab Studio (Easy Mode)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://help.cleanlab.ai">Cleanlab Studio Docs</a></li>
</ul>

</div>


<!-- Start of versioning -->

<div class="sidebar-tree">
    <p class="caption" role="heading">
        <span class="caption-text">Versions</span>
    </p>
    <ul>
        <li class="toctree-l1">
            <a
                id="version_number"
                class="reference internal"
                href="/cleanlab-docs/"
                >stable</a
            >
        </li>
        <li class="toctree-l1">
            <a
                id="commit_hash"
                class="reference internal"
                href="/cleanlab-docs/master/"
                >developer</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.7.0"
                class="reference internal"
                href="/cleanlab-docs/v2.7.0/"
                >v2.7.0</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.6.6"
                class="reference internal"
                href="/cleanlab-docs/v2.6.6/"
                >v2.6.6</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.6.5"
                class="reference internal"
                href="/cleanlab-docs/v2.6.5/"
                >v2.6.5</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.6.4"
                class="reference internal"
                href="/cleanlab-docs/v2.6.4/"
                >v2.6.4</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.6.3"
                class="reference internal"
                href="/cleanlab-docs/v2.6.3/"
                >v2.6.3</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.6.2"
                class="reference internal"
                href="/cleanlab-docs/v2.6.2/"
                >v2.6.2</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.6.1"
                class="reference internal"
                href="/cleanlab-docs/v2.6.1/"
                >v2.6.1</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.6.0"
                class="reference internal"
                href="/cleanlab-docs/v2.6.0/"
                >v2.6.0</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.5.0"
                class="reference internal"
                href="/cleanlab-docs/v2.5.0/"
                >v2.5.0</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.4.0"
                class="reference internal"
                href="/cleanlab-docs/v2.4.0/"
                >v2.4.0</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.3.1"
                class="reference internal"
                href="/cleanlab-docs/v2.3.1/"
                >v2.3.1</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.3.0"
                class="reference internal"
                href="/cleanlab-docs/v2.3.0/"
                >v2.3.0</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.2.0"
                class="reference internal"
                href="/cleanlab-docs/v2.2.0/"
                >v2.2.0</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.1.0"
                class="reference internal"
                href="/cleanlab-docs/v2.1.0/"
                >v2.1.0</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v2.0.0"
                class="reference internal"
                href="/cleanlab-docs/v2.0.0/"
                >v2.0.0</a
            >
        </li>
        
        <li class="toctree-l1">
            <a
                id="v1.0.1"
                class="reference internal"
                href="/cleanlab-docs/v1.0.1/"
                >v1.0.1</a
            >
        </li>
        
    </ul>
</div>

<br>
<br>

<script
    type="text/javascript"
    src="/cleanlab-docs/versioning.js"
></script>

<script type="text/javascript">
    window.addEventListener("load", () => {
        const version_number = Version.version_number;
        const commit_hash = Version.commit_hash;

        document.getElementById("version_number").innerHTML =
            "stable <code class='docutils literal notranslate'><span class='pre'> (" +
            version_number +
            ")</span></code>";
        document.getElementById("commit_hash").innerHTML =
            "master <code class='docutils literal notranslate'><span class='pre'> (" +
            commit_hash.slice(0, 7) +
            "&hellip;)</span></code>";
    });
</script>

<!-- End of versioning -->

</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          

<noscript>
    <div class="admonition warning">
        <p class="admonition-title">Warning</p>
        <p>
            Parts of this site uses JavaScript, but your browser does not
            support it.
        </p>
    </div>
</noscript>

<div>
    <agility-assistant
        access-token="public-assistant-1e1cd1d0-5f87546555cc7497"
        assistant-id="69391e48-a95f-4f8d-8dc2-025f1e1cd1d0"
        assistant-title="Cleanlab Open Source Assistant"
        assistant-placeholder="Ask a question"
        assistant-description="An assistant to help you with your questions about Cleanlab Open Source"
        logo-url="https://cleanlab.ai/icon-512.png"
    />
</div>



<!-- Start of Version Warning Banner -->

<p id="doc_ver_warning"></p>

<script type="text/javascript" src="/cleanlab-docs/versioning.js"></script>
<script type="text/javascript">
    window.addEventListener("load", () => {
        const version_number = Version.version_number;
        const path_arr = window.location.pathname.split("/");

        if (path_arr.includes("master")) {
            document.getElementById(
                "doc_ver_warning"
            ).innerHTML = `<div class="admonition warning">
            <p class="admonition-title">Warning</p>
            <p>This version of the documentation corresponds to the master branch of <code class="docutils literal notranslate"><span class="pre">cleanlab</span></code> source code from <a href="https://github.com/cleanlab/cleanlab/">GitHub</a>. To see the documentation for the latest <code class="docutils literal notranslate"><span class="pre">pip</span></code>-installed version, click <a href="/cleanlab-docs/">here</a>.</p>
            </div>`;
        } else if (
            !path_arr.includes(version_number) &&
            !path_arr.includes("stable")
        ) {
            document.getElementById("doc_ver_warning").innerHTML =
                `<div class="admonition warning">
            <p class="admonition-title">Warning</p>
            <p>This documentation is for an old version (<code class="docutils literal notranslate"><span class="pre">master</span></code>) of <code class="docutils literal notranslate"><span class="pre">cleanlab</span></code>. To see the documentation for the latest stable version (<code class="docutils literal notranslate"><span class="pre">` +
                version_number +
                `</span></code>), click <a href="/cleanlab-docs/">here</a>.</p>
            </div>`;
        } else {
            document.getElementById("doc_ver_warning").remove();
        }
    });
</script>

<!-- End of Version Warning Banner -->

 <h1>Source code for cleanlab.object_detection.summary</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2017-2023  Cleanlab Inc.</span>
<span class="c1"># This file is part of cleanlab.</span>
<span class="c1">#</span>
<span class="c1"># cleanlab is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Affero General Public License as published</span>
<span class="c1"># by the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># cleanlab is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Affero General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU Affero General Public License</span>
<span class="c1"># along with cleanlab.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Methods to display examples and their label issues in an object detection dataset.</span>
<span class="sd">Here each image can have multiple objects, each with its own bounding box and class label.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">DefaultDict</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">cleanlab.internal.constants</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">MAX_CLASS_TO_SHOW</span><span class="p">,</span>
    <span class="n">ALPHA</span><span class="p">,</span>
    <span class="n">EPSILON</span><span class="p">,</span>
    <span class="n">TINY_VALUE</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cleanlab.object_detection.filter</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">_filter_by_class</span><span class="p">,</span>
    <span class="n">_calculate_true_positives_false_positives</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cleanlab.object_detection.rank</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">_get_valid_inputs_for_compute_scores</span><span class="p">,</span>
    <span class="n">_separate_prediction</span><span class="p">,</span>
    <span class="n">_separate_label</span><span class="p">,</span>
    <span class="n">_get_prediction_type</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">cleanlab.internal.object_detection_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">bbox_xyxy_to_xywh</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">PIL.Image</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">Image</span>  <span class="c1"># pragma: no cover</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">Image</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="object_counts_per_image"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.object_counts_per_image">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">object_counts_per_image</span><span class="p">(</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">predictions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">auxiliary_inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">List</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the number of annotated and predicted objects for each image in the dataset.</span>

<span class="sd">    This method can help you discover images with abnormally many/few object annotations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labels :</span>
<span class="sd">        Annotated boxes and class labels in the original dataset, which may contain some errors.</span>
<span class="sd">        This is a list of ``N`` dictionaries such that ``labels[i]`` contains the given labels for the `i`-th image in the following format:</span>
<span class="sd">        ``{&#39;bboxes&#39;: np.ndarray((L,4)), &#39;labels&#39;: np.ndarray((L,)), &#39;image_name&#39;: str}`` where ``L`` is the number of annotated bounding boxes</span>
<span class="sd">        for the `i`-th image and ``bboxes[l]`` is a bounding box of coordinates in ``[x1,y1,x2,y2]`` format with given class label ``labels[j]``.</span>
<span class="sd">        ``image_name`` is an optional part of the labels that can be used to later refer to specific images.</span>

<span class="sd">        Note: Here, ``(x1,y1)`` corresponds to the top-left and ``(x2,y2)`` corresponds to the bottom-right corner of the bounding box with respect to the image matrix [e.g. `XYXY in Keras &lt;https://keras.io/api/keras_cv/bounding_box/formats/&gt;`, `Detectron 2 &lt;https://detectron2.readthedocs.io/en/latest/modules/utils.html#detectron2.utils.visualizer.Visualizer.draw_box&gt;`].</span>

<span class="sd">        For more information on proper labels formatting, check out the `MMDetection library &lt;https://mmdetection.readthedocs.io/en/dev-3.x/advanced_guides/customize_dataset.html&gt;`_.</span>

<span class="sd">    predictions :</span>
<span class="sd">        Predictions output by a trained object detection model.</span>
<span class="sd">        For the most accurate results, predictions should be out-of-sample to avoid overfitting, eg. obtained via :ref:`cross-validation &lt;pred_probs_cross_val&gt;`.</span>
<span class="sd">        This is a list of ``N`` ``np.ndarray`` such that ``predictions[i]`` corresponds to the model prediction for the `i`-th image.</span>
<span class="sd">        For each possible class ``k`` in 0, 1, ..., K-1: ``predictions[i][k]`` is a ``np.ndarray`` of shape ``(M,5)``,</span>
<span class="sd">        where ``M`` is the number of predicted bounding boxes for class ``k``. Here the five columns correspond to ``[x1,y1,x2,y2,pred_prob]``,</span>
<span class="sd">        where ``[x1,y1,x2,y2]`` are coordinates of the bounding box predicted by the model</span>
<span class="sd">        and ``pred_prob`` is the model&#39;s confidence in the predicted class label for this bounding box.</span>

<span class="sd">        Note: Here, ``(x1,y1)`` corresponds to the top-left and ``(x2,y2)`` corresponds to the bottom-right corner of the bounding box with respect to the image matrix [e.g. `XYXY in Keras &lt;https://keras.io/api/keras_cv/bounding_box/formats/&gt;`, `Detectron 2 &lt;https://detectron2.readthedocs.io/en/latest/modules/utils.html#detectron2.utils.visualizer.Visualizer.draw_box&gt;`]. The last column, pred_prob, represents the predicted probability that the bounding box contains an object of the class k.</span>

<span class="sd">        For more information see the `MMDetection package &lt;https://github.com/open-mmlab/mmdetection&gt;`_ for an example object detection library that outputs predictions in the correct format.</span>

<span class="sd">    auxiliary_inputs: optional</span>
<span class="sd">        Auxiliary inputs to be used in the computation of counts.</span>
<span class="sd">        The `auxiliary_inputs` can be computed using :py:func:`rank._get_valid_inputs_for_compute_scores &lt;cleanlab.object_detection.rank._get_valid_inputs_for_compute_scores&gt;`.</span>
<span class="sd">        It is internally computed from the given `labels` and `predictions`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    object_counts: Tuple[List, List]</span>
<span class="sd">        A tuple containing two lists. The first is an array of shape ``(N,)`` containing the number of annotated objects for each image in the dataset.</span>
<span class="sd">        The second is an array of shape ``(N,)`` containing the number of predicted objects for each image in the dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">auxiliary_inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">auxiliary_inputs</span> <span class="o">=</span> <span class="n">_get_valid_inputs_for_compute_scores</span><span class="p">(</span><span class="n">ALPHA</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;lab_bboxes&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">auxiliary_inputs</span><span class="p">],</span>
        <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;pred_bboxes&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">auxiliary_inputs</span><span class="p">],</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="bounding_box_size_distribution"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.bounding_box_size_distribution">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">bounding_box_size_distribution</span><span class="p">(</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">predictions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">auxiliary_inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">class_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the distribution over sizes of annotated and predicted bounding boxes across the dataset, broken down by each class.</span>

<span class="sd">    This method can help you find annotated/predicted boxes for a particular class that are abnormally big/small.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labels:</span>
<span class="sd">        Annotated boxes and class labels in the original dataset, which may contain some errors.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    predictions:</span>
<span class="sd">        Predictions output by a trained object detection model.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    auxiliary_inputs: optional</span>
<span class="sd">        Auxiliary inputs to be used in the computation of counts.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    class_names: optional</span>
<span class="sd">        A dictionary mapping one-hot-encoded class labels back to their original class names in the format ``{&quot;integer-label&quot;: &quot;original-class-name&quot;}``.</span>
<span class="sd">        You can use this argument to control the classes for which the size distribution is computed.</span>

<span class="sd">    sort: bool</span>
<span class="sd">        If True, the returned dictionaries are sorted by the number of instances of each class in the dataset in descending order.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bbox_sizes: Tuple[Dict[Any, List], Dict[Any, List]]</span>
<span class="sd">        A tuple containing two dictionaries. Each maps each class label to a list of the sizes of annotated bounding boxes for that class in the label and prediction datasets, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">auxiliary_inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">auxiliary_inputs</span> <span class="o">=</span> <span class="n">_get_valid_inputs_for_compute_scores</span><span class="p">(</span><span class="n">ALPHA</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

    <span class="n">lab_area</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">pred_area</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">auxiliary_inputs</span><span class="p">:</span>
        <span class="n">_get_bbox_areas</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;lab_labels&quot;</span><span class="p">],</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;lab_bboxes&quot;</span><span class="p">],</span> <span class="n">lab_area</span><span class="p">,</span> <span class="n">class_names</span><span class="p">)</span>
        <span class="n">_get_bbox_areas</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;pred_labels&quot;</span><span class="p">],</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;pred_bboxes&quot;</span><span class="p">],</span> <span class="n">pred_area</span><span class="p">,</span> <span class="n">class_names</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="n">lab_area</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">lab_area</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">pred_area</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pred_area</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>

    <span class="k">return</span> <span class="n">lab_area</span><span class="p">,</span> <span class="n">pred_area</span></div>


<div class="viewcode-block" id="class_label_distribution"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.class_label_distribution">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">class_label_distribution</span><span class="p">(</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">predictions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">auxiliary_inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">class_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the distribution of class labels associated with all annotated bounding boxes (or predicted bounding boxes) in the dataset.</span>

<span class="sd">    This method can help you understand which classes are: rare or over/under-predicted by the model overall.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labels:</span>
<span class="sd">        Annotated boxes and class labels in the original dataset, which may contain some errors.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    predictions:</span>
<span class="sd">        Predictions output by a trained object detection model.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    auxiliary_inputs: optional</span>
<span class="sd">        Auxiliary inputs to be used in the computation of counts.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    class_names: optional</span>
<span class="sd">        Optional dictionary mapping one-hot-encoded class labels back to their original class names in the format ``{&quot;integer-label&quot;: &quot;original-class-name&quot;}``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    class_distribution: Tuple[Dict[Any, float], Dict[Any, float]]</span>
<span class="sd">        A tuple containing two dictionaries. The first is a dictionary mapping each class label to its frequency in the dataset annotations.</span>
<span class="sd">        The second is a dictionary mapping each class label to its frequency in the model predictions across all images in the dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">auxiliary_inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">auxiliary_inputs</span> <span class="o">=</span> <span class="n">_get_valid_inputs_for_compute_scores</span><span class="p">(</span><span class="n">ALPHA</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

    <span class="n">lab_freq</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">pred_freq</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">auxiliary_inputs</span><span class="p">:</span>
        <span class="n">_get_class_instances</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;lab_labels&quot;</span><span class="p">],</span> <span class="n">lab_freq</span><span class="p">,</span> <span class="n">class_names</span><span class="p">)</span>
        <span class="n">_get_class_instances</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;pred_labels&quot;</span><span class="p">],</span> <span class="n">pred_freq</span><span class="p">,</span> <span class="n">class_names</span><span class="p">)</span>

    <span class="n">label_norm</span> <span class="o">=</span> <span class="n">_normalize_by_total</span><span class="p">(</span><span class="n">lab_freq</span><span class="p">)</span>
    <span class="n">pred_norm</span> <span class="o">=</span> <span class="n">_normalize_by_total</span><span class="p">(</span><span class="n">pred_freq</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">label_norm</span><span class="p">,</span> <span class="n">pred_norm</span></div>


<div class="viewcode-block" id="get_sorted_bbox_count_idxs"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.get_sorted_bbox_count_idxs">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_sorted_bbox_count_idxs</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a tuple of idxs and bounding box counts of images sorted from highest to lowest number of bounding boxes.</span>

<span class="sd">    This plot can help you discover images with abnormally many/few object annotations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labels:</span>
<span class="sd">        Annotated boxes and class labels in the original dataset, which may contain some errors.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    predictions:</span>
<span class="sd">        Predictions output by a trained object detection model.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sorted_idxs: List[Tuple[int, int]], List[Tuple[int, int]]</span>
<span class="sd">        A tuple containing two lists. The first is an array of shape ``(N,)`` containing the number of annotated objects for each image in the dataset.</span>
<span class="sd">        The second is an array of shape ``(N,)`` containing the number of predicted objects for each image in the dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lab_count</span><span class="p">,</span> <span class="n">pred_count</span> <span class="o">=</span> <span class="n">object_counts_per_image</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="n">lab_grouped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">lab_count</span><span class="p">))</span>
    <span class="n">pred_grouped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">pred_count</span><span class="p">))</span>

    <span class="n">sorted_lab</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lab_grouped</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sorted_pred</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pred_grouped</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sorted_lab</span><span class="p">,</span> <span class="n">sorted_pred</span></div>


<div class="viewcode-block" id="plot_class_size_distributions"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.plot_class_size_distributions">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">plot_class_size_distributions</span><span class="p">(</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_to_show</span><span class="o">=</span><span class="n">MAX_CLASS_TO_SHOW</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the size distributions for bounding boxes for each class.</span>

<span class="sd">    This plot can help you find annotated/predicted boxes for a particular class that are abnormally big/small.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labels:</span>
<span class="sd">        Annotated boxes and class labels in the original dataset, which may contain some errors.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    predictions:</span>
<span class="sd">        Predictions output by a trained object detection model.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    class_names: optional</span>
<span class="sd">        Optional dictionary mapping one-hot-encoded class labels back to their original class names in the format ``{&quot;integer-label&quot;: &quot;original-class-name&quot;}``.</span>
<span class="sd">        You can use this argument to control the classes for which the size distribution is plotted.</span>

<span class="sd">    class_to_show: optional</span>
<span class="sd">        The number of classes to show in the plots. Classes over `class_to_show` are hidden. If this argument is provided, then the classes are sorted by the number of instances in the dataset.</span>
<span class="sd">        Defaults to `MAX_CLASS_TO_SHOW` which is set to 10.</span>

<span class="sd">    kwargs:</span>
<span class="sd">        Additional keyword arguments to pass to ``plt.show()`` (matplotlib.pyplot.show).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;This functionality requires matplotlib. Install it via: `pip install matplotlib`&quot;</span>
        <span class="p">)</span>

    <span class="n">lab_boxes</span><span class="p">,</span> <span class="n">pred_boxes</span> <span class="o">=</span> <span class="n">bounding_box_size_distribution</span><span class="p">(</span>
        <span class="n">labels</span><span class="p">,</span>
        <span class="n">predictions</span><span class="p">,</span>
        <span class="n">class_names</span><span class="o">=</span><span class="n">class_names</span><span class="p">,</span>
        <span class="n">sort</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">class_to_show</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lab_boxes</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">class_to_show</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size distributions for bounding box for class </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">lab_boxes</span><span class="p">,</span> <span class="n">pred_boxes</span><span class="p">]):</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;box area (pixels)&quot;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;annotated&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;predicted&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_class_distribution"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.plot_class_distribution">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">plot_class_distribution</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the distribution of class labels associated with all annotated bounding boxes and predicted bounding boxes in the dataset.</span>

<span class="sd">    This plot can help you understand which classes are rare or over/under-predicted by the model overall.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labels:</span>
<span class="sd">        Annotated boxes and class labels in the original dataset, which may contain some errors.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    predictions:</span>
<span class="sd">        Predictions output by a trained object detection model.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_counts_per_image &lt;cleanlab.object_detection.summary.object_counts_per_image&gt;` for further details.</span>

<span class="sd">    class_names: optional</span>
<span class="sd">        Optional dictionary mapping one-hot-encoded class labels back to their original class names in the format ``{&quot;integer-label&quot;: &quot;original-class-name&quot;}``.</span>

<span class="sd">    kwargs:</span>
<span class="sd">        Additional keyword arguments to pass to ``plt.show()`` (matplotlib.pyplot.show).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;This functionality requires matplotlib. Install it via: `pip install matplotlib`&quot;</span>
        <span class="p">)</span>

    <span class="n">lab_dist</span><span class="p">,</span> <span class="n">pred_dist</span> <span class="o">=</span> <span class="n">class_label_distribution</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="n">class_names</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distribution of classes in the dataset&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">lab_dist</span><span class="p">,</span> <span class="n">pred_dist</span><span class="p">]):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">labels</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">autopct</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.1f%%</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Annotated&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;Predicted&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="visualize"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.visualize">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Image</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prediction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prediction_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">overlay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">class_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the annotated bounding boxes (given labels) and predicted bounding boxes (model predictions) for a particular image.</span>
<span class="sd">    Given labels are shown in red, model predictions in blue.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image:</span>
<span class="sd">        Image object loaded into memory or full path to the image file. If path is provided, image is loaded into memory.</span>

<span class="sd">    label:</span>
<span class="sd">        The given label for a single image in the format ``{&#39;bboxes&#39;: np.ndarray((L,4)), &#39;labels&#39;: np.ndarray((L,))}`` where</span>
<span class="sd">        ``L`` is the number of bounding boxes for the `i`-th image and ``bboxes[j]`` is in the format ``[x1,y1,x2,y2]`` with given label ``labels[j]``.</span>

<span class="sd">        Note: Here, ``(x1,y1)`` corresponds to the top-left and ``(x2,y2)`` corresponds to the bottom-right corner of the bounding box with respect to the image matrix [e.g. `XYXY in Keras &lt;https://keras.io/api/keras_cv/bounding_box/formats/&gt;`, `Detectron 2 &lt;https://detectron2.readthedocs.io/en/latest/modules/utils.html#detectron2.utils.visualizer.Visualizer.draw_box&gt;`].</span>

<span class="sd">    prediction:</span>
<span class="sd">        A prediction for a single image in the format ``np.ndarray((K,))`` and ``prediction[k]`` is of shape ``np.ndarray(N,5)``</span>
<span class="sd">        where ``M`` is the number of predicted bounding boxes for class ``k`` and the five columns correspond to ``[x,y,x,y,pred_prob]`` where</span>
<span class="sd">        ``[x1,y1,x2,y2]`` are the bounding box coordinates predicted by the model and ``pred_prob`` is the model&#39;s confidence in ``predictions[i]``.</span>

<span class="sd">        Note: Here, ``(x1,y1)`` corresponds to the top-left and ``(x2,y2)`` corresponds to the bottom-right corner of the bounding box with respect to the image matrix [e.g. `XYXY in Keras &lt;https://keras.io/api/keras_cv/bounding_box/formats/&gt;`, `Detectron 2 &lt;https://detectron2.readthedocs.io/en/latest/modules/utils.html#detectron2.utils.visualizer.Visualizer.draw_box&gt;`]. The last column, pred_prob, represents the predicted probability that the bounding box contains an object of the class k.</span>

<span class="sd">    prediction_threshold:</span>
<span class="sd">        All model-predicted bounding boxes with confidence (`pred_prob`)</span>
<span class="sd">        below this threshold are omitted from the visualization.</span>

<span class="sd">    overlay: bool</span>
<span class="sd">        If True, display a single image with given labels and predictions overlaid.</span>
<span class="sd">        If False, display two images (side by side) with the left image showing  the model predictions and the right image showing the given label.</span>

<span class="sd">    class_names:</span>
<span class="sd">        Optional dictionary mapping one-hot-encoded class labels back to their original class names in the format ``{&quot;integer-label&quot;: &quot;original-class-name&quot;}``.</span>

<span class="sd">    save_path:</span>
<span class="sd">        Path to save figure at. If a path is provided, the figure is saved. To save in a specific image format, add desired file extension to the end of `save_path`. Allowed file extensions are: &#39;png&#39;, &#39;pdf&#39;, &#39;ps&#39;, &#39;eps&#39;, and &#39;svg&#39;.</span>

<span class="sd">    figsize:</span>
<span class="sd">        Optional figure size for plotting the image.</span>
<span class="sd">        Corresponds to ``matplotlib.figure.figsize``.</span>

<span class="sd">    kwargs:</span>
<span class="sd">        Additional keyword arguments to pass to ``plt.show()`` (matplotlib.pyplot.show).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.axes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Axes</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;This functionality requires matplotlib. Install it via: `pip install matplotlib`&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create figure and axes</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prediction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prediction_type</span> <span class="o">=</span> <span class="n">_get_prediction_type</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
        <span class="n">pbbox</span><span class="p">,</span> <span class="n">plabels</span><span class="p">,</span> <span class="n">pred_probs</span> <span class="o">=</span> <span class="n">_separate_prediction</span><span class="p">(</span>
            <span class="n">prediction</span><span class="p">,</span> <span class="n">prediction_type</span><span class="o">=</span><span class="n">prediction_type</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keep_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pred_probs</span> <span class="o">&gt;</span> <span class="n">prediction_threshold</span><span class="p">)</span>
            <span class="n">pbbox</span> <span class="o">=</span> <span class="n">pbbox</span><span class="p">[</span><span class="n">keep_idx</span><span class="p">]</span>
            <span class="n">plabels</span> <span class="o">=</span> <span class="n">plabels</span><span class="p">[</span><span class="n">keep_idx</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">abbox</span><span class="p">,</span> <span class="n">alabels</span> <span class="o">=</span> <span class="n">_separate_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">overlay</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">figsize</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_draw_boxes</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">abbox</span><span class="p">,</span> <span class="n">alabels</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">prediction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_draw_boxes</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pbbox</span><span class="p">,</span> <span class="n">plabels</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">figsize</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Axes</span><span class="p">,</span> <span class="n">Axes</span><span class="p">],</span> <span class="n">axes</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_draw_boxes</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">abbox</span><span class="p">,</span> <span class="n">alabels</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">prediction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_draw_boxes</span><span class="p">(</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pbbox</span><span class="p">,</span> <span class="n">plabels</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
    <span class="n">bbox_extra_artists</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">or</span> <span class="n">prediction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">legend</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">_plot_legend</span><span class="p">(</span><span class="n">class_names</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
        <span class="n">bbox_extra_artists</span> <span class="o">=</span> <span class="p">(</span><span class="n">legend</span><span class="p">,)</span>

    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">allowed_image_formats</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;ps&quot;</span><span class="p">,</span> <span class="s2">&quot;eps&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">])</span>
        <span class="n">image_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">save_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">allowed_image_formats</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">save_path</span><span class="p">:</span>
            <span class="n">image_format</span> <span class="o">=</span> <span class="n">save_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="n">save_path</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">image_format</span><span class="p">,</span>
            <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="n">bbox_extra_artists</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
            <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_per_class_confusion_matrix_dict_</span><span class="p">(</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">predictions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">iou_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">num_procs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a confusion matrix dictionary for each class containing the number of True Positive, False Positive, and False Negative detections from the object detection model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">num_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">num_procs</span><span class="p">)</span>
    <span class="n">counter_dict</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;TP&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;FP&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;FN&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">class_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_classes</span><span class="p">):</span>
        <span class="n">pred_bboxes</span><span class="p">,</span> <span class="n">lab_bboxes</span> <span class="o">=</span> <span class="n">_filter_by_class</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">class_num</span><span class="p">)</span>
        <span class="n">tpfpfn</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span>
            <span class="n">_calculate_true_positives_false_positives</span><span class="p">,</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="n">pred_bboxes</span><span class="p">,</span>
                <span class="n">lab_bboxes</span><span class="p">,</span>
                <span class="p">[</span><span class="n">iou_threshold</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">)],</span>
                <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">)],</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">image_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tpfpfn</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
            <span class="n">counter_dict</span><span class="p">[</span><span class="n">class_num</span><span class="p">][</span><span class="s2">&quot;TP&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
            <span class="n">counter_dict</span><span class="p">[</span><span class="n">class_num</span><span class="p">][</span><span class="s2">&quot;FP&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="n">counter_dict</span><span class="p">[</span><span class="n">class_num</span><span class="p">][</span><span class="s2">&quot;FN&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">counter_dict</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_sort_dict_to_list</span><span class="p">(</span><span class="n">index_value_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a dictionary to a list sorted by index and return the values in that order.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - index_value_dict (dict): The input dictionary where keys represent indices and values are the corresponding elements.</span>

<span class="sd">    Returns:</span>
<span class="sd">    list: A list containing the values from the input dictionary, sorted by index.</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; my_dict = {&#39;0&#39;: &#39;0&#39;, &#39;1&#39;: &#39;1&#39;, &#39;2&#39;: &#39;2&#39;, &#39;3&#39;: &#39;3&#39;, &#39;4&#39;: &#39;4&#39;}</span>
<span class="sd">    &gt;&gt;&gt; sort_dict_to_list(my_dict)</span>
<span class="sd">    [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sorted_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">index_value_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">sorted_list</span>


<div class="viewcode-block" id="get_average_per_class_confusion_matrix"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.get_average_per_class_confusion_matrix">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_average_per_class_confusion_matrix</span><span class="p">(</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">predictions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">num_procs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">class_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute a confusion matrix dictionary for each class containing the average number of True Positive, False Positive, and False Negative detections from the object detection model across a range of Intersection over Union thresholds.</span>

<span class="sd">    At each IoU threshold, the metrics are calculated as follows:</span>
<span class="sd">    - True Positive (TP): Instances where the model correctly identifies the class with IoU above the threshold.</span>
<span class="sd">    - False Positive (FP): Instances where the model predicts the class, but IoU is below the threshold.</span>
<span class="sd">    - False Negative (FN): Instances where the ground truth class is not predicted by the model.</span>

<span class="sd">    The average confusion matrix provides insights into the model strengths and potential biases.</span>

<span class="sd">    Note:  lower TP at certain IoU thresholds does not necessarily imply that everything else is FP, instead it indicates that, at those specific IoU thresholds, the model is not performing as well in terms of correctly identifying class instances. The other metrics (FP and FN) provide additional information about the model&#39;s behavior.</span>

<span class="sd">    Note: Since we average over many IoU thresholds, &#39;TP&#39;, &#39;FP&#39;, and &#39;FN&#39; may contain float values representing the average across these thresholds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labels:</span>
<span class="sd">        A list of ``N`` dictionaries such that ``labels[i]`` contains the given labels for the `i`-th image.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_detection.filter.find_label_issues &lt;cleanlab.object_detection.filter.find_label_issues&gt;` for further details.</span>

<span class="sd">    predictions:</span>
<span class="sd">        A list of ``N`` ``np.ndarray`` such that ``predictions[i]`` corresponds to the model predictions for the `i`-th image.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_detection.filter.find_label_issues &lt;cleanlab.object_detection.filter.find_label_issues&gt;` for further details.</span>

<span class="sd">    num_procs:</span>
<span class="sd">        Number of processes for parallelization. Default is 1.</span>

<span class="sd">    class_names:</span>
<span class="sd">        Optional dictionary mapping one-hot-encoded class labels back to their original class names in the format ``{&quot;integer-label&quot;: &quot;original-class-name&quot;}``</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    avg_metrics: dict</span>
<span class="sd">        A distionary containing the average confusion matrix.</span>

<span class="sd">        The default range of Intersection over Union thresholds is from 0.5 to 0.95 with a step size of 0.05.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iou_thrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="mf">0.95</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.05</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">class_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_classes</span><span class="p">))}</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="n">_sort_dict_to_list</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span>
    <span class="n">avg_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">class_num</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;TP&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;FP&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;FN&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span> <span class="k">for</span> <span class="n">class_num</span> <span class="ow">in</span> <span class="n">class_names</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">iou_threshold</span> <span class="ow">in</span> <span class="n">iou_thrs</span><span class="p">:</span>
        <span class="n">results_dict</span> <span class="o">=</span> <span class="n">_get_per_class_confusion_matrix_dict_</span><span class="p">(</span>
            <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">iou_threshold</span><span class="p">,</span> <span class="n">num_procs</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">class_num</span> <span class="ow">in</span> <span class="n">results_dict</span><span class="p">:</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">class_num</span><span class="p">][</span><span class="s2">&quot;TP&quot;</span><span class="p">]</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">class_num</span><span class="p">][</span><span class="s2">&quot;FP&quot;</span><span class="p">]</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">class_num</span><span class="p">][</span><span class="s2">&quot;FN&quot;</span><span class="p">]</span>

            <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_names</span><span class="p">[</span><span class="n">class_num</span><span class="p">]][</span><span class="s2">&quot;TP&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tp</span>
            <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_names</span><span class="p">[</span><span class="n">class_num</span><span class="p">]][</span><span class="s2">&quot;FP&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fp</span>
            <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_names</span><span class="p">[</span><span class="n">class_num</span><span class="p">]][</span><span class="s2">&quot;FN&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fn</span>

    <span class="n">num_thresholds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iou_thrs</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="n">avg_metrics</span><span class="p">:</span>
        <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_name</span><span class="p">][</span><span class="s2">&quot;TP&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">num_thresholds</span>
        <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_name</span><span class="p">][</span><span class="s2">&quot;FP&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">num_thresholds</span>
        <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_name</span><span class="p">][</span><span class="s2">&quot;FN&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">num_thresholds</span>
    <span class="k">return</span> <span class="n">avg_metrics</span></div>


<div class="viewcode-block" id="calculate_per_class_metrics"><a class="viewcode-back" href="../../../cleanlab/object_detection/summary.html#cleanlab.object_detection.summary.calculate_per_class_metrics">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_per_class_metrics</span><span class="p">(</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">predictions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">num_procs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">class_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the object detection model&#39;s precision, recall, and F1 score for each class in the dataset.</span>

<span class="sd">    These metrics can help you identify model strengths and weaknesses, and provide reference statistics for model evaluation and comparisons.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    labels:</span>
<span class="sd">        A list of ``N`` dictionaries such that ``labels[i]`` contains the given labels for the `i`-th image.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_detection.filter.find_label_issues &lt;cleanlab.object_detection.filter.find_label_issues&gt;` for further details.</span>

<span class="sd">    predictions:</span>
<span class="sd">        A list of ``N`` ``np.ndarray`` such that ``predictions[i]`` corresponds to the model predictions for the `i`-th image.</span>
<span class="sd">        Refer to documentation for this argument in :py:func:`object_detection.filter.find_label_issues &lt;cleanlab.object_detection.filter.find_label_issues&gt;` for further details.</span>

<span class="sd">    num_procs:</span>
<span class="sd">        Number of processes for parallelization. Default is 1.</span>

<span class="sd">    class_names:</span>
<span class="sd">        Optional dictionary mapping one-hot-encoded class labels back to their original class names in the format ``{&quot;integer-label&quot;: &quot;original-class-name&quot;}``</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    per_class_metrics: dict</span>
<span class="sd">        A dictionary containing per-class metrics computed from the object detection model&#39;s average confusion matrix values across a range of Intersection over Union thresholds.</span>

<span class="sd">        The default range of Intersection over Union thresholds is from 0.5 to 0.95 with a step size of 0.05.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">avg_metrics</span> <span class="o">=</span> <span class="n">get_average_per_class_confusion_matrix</span><span class="p">(</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">num_procs</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="n">class_names</span>
    <span class="p">)</span>

    <span class="n">avg_metrics_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="n">avg_metrics</span><span class="p">:</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_name</span><span class="p">][</span><span class="s2">&quot;TP&quot;</span><span class="p">]</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_name</span><span class="p">][</span><span class="s2">&quot;FP&quot;</span><span class="p">]</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">avg_metrics</span><span class="p">[</span><span class="n">class_name</span><span class="p">][</span><span class="s2">&quot;FN&quot;</span><span class="p">]</span>

        <span class="n">precision</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">TINY_VALUE</span><span class="p">)</span>  <span class="c1"># Avoid division by zero</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">+</span> <span class="n">TINY_VALUE</span><span class="p">)</span>  <span class="c1"># Avoid division by zero</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span> <span class="o">+</span> <span class="n">TINY_VALUE</span><span class="p">)</span>  <span class="c1"># Avoid division by zero</span>

        <span class="n">avg_metrics_dict</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;average precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
            <span class="s2">&quot;average recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
            <span class="s2">&quot;average f1&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">avg_metrics_dict</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_normalize_by_total</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to normalize a frequency distribution.&quot;&quot;&quot;</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">freq</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">v</span> <span class="o">/</span> <span class="p">(</span><span class="n">total</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">freq</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_bbox_areas</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">boxes</span><span class="p">,</span> <span class="n">class_area_dict</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to compute the area of bounding boxes for each class.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">cl</span><span class="p">,</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">boxes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">class_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">class_names</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">cl</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)]</span>
        <span class="n">class_area_dict</span><span class="p">[</span><span class="n">cl</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_class_instances</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">class_instances_dict</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to count the number of class instances in each image.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">class_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cl</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)]</span>
        <span class="n">class_instances_dict</span><span class="p">[</span><span class="n">cl</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_plot_legend</span><span class="p">(</span><span class="n">class_names</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">prediction</span><span class="p">):</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">]</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
    <span class="n">colors</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">prediction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>

    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">markers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;s&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
    <span class="n">markers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;s&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">prediction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$\bf</span><span class="si">{Legend}</span><span class="s2">$&quot;</span><span class="p">]</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;given label&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;predicted label&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">prediction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>

    <span class="k">if</span> <span class="n">class_names</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">),</span> <span class="n">MAX_CLASS_TO_SHOW</span><span class="p">)</span>
        <span class="n">markers</span> <span class="o">+=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">class_key</span><span class="si">}</span><span class="s2">$&quot;</span> <span class="k">for</span> <span class="n">class_key</span> <span class="ow">in</span> <span class="n">class_names</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">labels</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$\bf</span><span class="si">{classes}</span><span class="s2">$&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">class_names</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;This functionality requires matplotlib. Install it via: `pip install matplotlib`&quot;</span>
        <span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">marker</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="k">for</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">colors</span><span class="p">)]</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">legend</span><span class="p">,</span> <span class="n">plt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_draw_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">edgecolor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to draw labels on an axis.&quot;&quot;&quot;</span>

    <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
    <span class="n">c_xleft</span> <span class="o">=</span> <span class="n">rx</span> <span class="o">+</span> <span class="mi">10</span>
    <span class="n">c_xright</span> <span class="o">=</span> <span class="n">rx</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="n">c_ytop</span> <span class="o">=</span> <span class="n">ry</span> <span class="o">+</span> <span class="mi">12</span>

    <span class="k">if</span> <span class="n">edgecolor</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">c_xleft</span><span class="p">,</span> <span class="n">c_ytop</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># edgecolor == b</span>
        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">c_xright</span><span class="p">,</span> <span class="n">c_ytop</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span>
    <span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">set_bbox</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_draw_boxes</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to draw bboxes and labels on an axis.&quot;&quot;&quot;</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox_xyxy_to_xywh</span><span class="p">(</span><span class="n">box</span><span class="p">)</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rectangle</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;This functionality requires matplotlib. Install it via: `pip install matplotlib`&quot;</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bboxes</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
            <span class="n">w</span><span class="p">,</span>
            <span class="n">h</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">_draw_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">edgecolor</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</pre></div> 
        </article>
      </div>
      <footer>
         
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Cleanlab Inc.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/cleanlab/cleanlab" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        

<script type="text/javascript">
    window.addEventListener("load", () => {
        let elements = document.getElementsByClassName("left-details");

        elements[0].insertAdjacentHTML(
            "afterbegin",
            `<code class="docutils literal notranslate"><span class="pre">cleanlab</span></code> is distributed on <a href="https://pypi.org/project/cleanlab/">PyPI</a> and <a href="https://anaconda.org/conda-forge/cleanlab">conda</a>.`
        );
    });
</script>


      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=2b91c5f0"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../../_static/tabs.js?v=3030b3cb"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdn.cleanlab.ai/v1.1.1/agility-web-component.js"></script>
</body>
</html>